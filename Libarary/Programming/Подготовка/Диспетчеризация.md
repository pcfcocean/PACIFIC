#  Диспетчеризация

Диспетчеризации методов (Method Dispatch) - это процесс выбора имплементации метода при его вызове
 Процесс, который происходит между вызовом функции и ее выполнением, в ходе которого система определяет какую реализацию метода осуществить (если, к примеру, есть разные переопределения метода в дочерних классах или используются протоколы с их расширениями).

[Direct Dispatch] (Статическая/прямая диспетчеризация)
 - Value типов
 - final классов
 - extension классов и протоколов
Определяет однозначно реализацию метода уже на этапе компиляции, поэтому самая быстрая.
То есть, можно сделать вывод, что статическая диспетчеризация применяется, когда метод не может быть переопределен.

[Table Dispatch]
Virtual Table
Witness Table

Формируется таблица с адресами методов сущности.
Она создается на этапе компиляции, а сам адрес метода ищется по таблице уже во время runtime, что сказывается на скорости работы.

Virtual Table - для наследования при работе с классами.
    Для каждого класса и для каждого его сабкласса создается виртуальная таблица с адресами методов.
    Для дочернего класса эта таблица копируется вместе с адресами.
    В случае когда реализация метода полностью переходит из родительского класса, адрес в таблице наследника такой же 
    Если какой-то метод переопределен через override, то адрес меняется на другую реализацию.

Witness Table - для классов работающих с протоколами.
    Для класса соответствующего Protocol создается отдельная таблица с адресами методов протокола.
    При вызове метода у объекта с типом протокола Protocol используется Witness Table диспетчеризация.
    В случае реализации классом нескольких протоколов, для каждого протокола будет создаваться отдельная таблица.
    Отличие от Virtual Table заключается в отсутствии наследования.


[Message Dispatch]
    Используется в связке с Objective-C через @objc dynamic или @objcMembers.
    Работает полностью в runtime.
Пример: Есть родительский и дочерний классы. Родительский класс наследуется от NSObject.
        Для работы Message Dispatch, методу добавляется модификатор @objc dynamic.
        Для каждого класса создаются таблицы, но они, в отличии от Table Dispatch, не копируются при наследовании, а
        в таблице дочернего класса есть ссылка super на родительский класс.
        При вызове метода у объекта дочернего класса, сначала идет поиск адреса у самого класса.
        Если не адрес не найден, то поиск продолжается у родительского класса, и так далее до NSObject.


// MARK: Example - All types of dispatching
protocol ProtocolExample {
    func executeWitnessTable()
}
class ClassExample: NSObject {
    @objc dynamic func executeMessageDispatch() {
        print("Message Dispatch")
    }
}
class SubclassExample: ClassExample, ProtocolExample {
    private func executeDirectDispatch() {
        print("Direct Dispatch")
    }
    func executeVirtualTable() {
        print("Virtual Table")
    }
    func executeWitnessTable() {
        print("Witness Table")
    }  
    @objc override dynamic func executeMessageDispatch() {
        print("Message Dispatch")
    }
}
